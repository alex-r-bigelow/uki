!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.uki={})}(this,function(e){"use strict";class t{requireProperties(e){e.forEach(e=>{if(void 0===this[e])throw new TypeError(e+" is undefined for class "+this.constructor.name)})}}class s extends t{constructor(){super(),this.eventHandlers={},this.stickyTriggers={}}on(e,t,s){this.eventHandlers[e]||(this.eventHandlers[e]=[]),(s||-1===this.eventHandlers[e].indexOf(t))&&this.eventHandlers[e].push(t)}off(e,t){if(this.eventHandlers[e])if(t){let s=this.eventHandlers[e].indexOf(t);s>=0&&this.eventHandlers[e].splice(s,1)}else delete this.eventHandlers[e]}trigger(e,...t){this.eventHandlers[e]&&this.eventHandlers[e].forEach(e=>{window.setTimeout(()=>{e.apply(this,t)},0)})}stickyTrigger(e,t,s=10){this.stickyTriggers[e]=this.stickyTriggers[e]||{argObj:{}},this.stickyTriggers[e].argObj=Object.assign(this.stickyTriggers.argObj,t),window.clearTimeout(this.stickyTriggers.timeout),this.stickyTriggers.timeout=window.setTimeout(()=>{let t=this.stickyTriggers[e].argObj;delete this.stickyTriggers[e],this.trigger(e,t)},s)}}e.AbstractClass=t,e.Model=s,e.View=class extends s{constructor(e,t={}){super(),this.requireProperties(["setup","draw"]),this.d3el=e,this.dirty=!0,this.drawTimeout=null,this.debounceWait=100,this.readyToRender=!1,this.loadResources(t)}loadStylesheet(e){let t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.media="screen",t.href=e,document.getElementsByTagName("head")[0].appendChild(t),t}async loadResources(e){this.resources={},e.style&&(this.resources.style=this.loadStylesheet(e.style),delete e.style);try{await Promise.all(Object.keys(e).reduce((t,s)=>{if(!d3[s])throw new Error("d3 has no function for fetching resource of type "+s);return t.push((async()=>{this.resources[s]=await d3[s](e[s])})()),t},[])),this.readyToRender=!0,this.render()}catch(e){throw e}}render(e=this.d3el){let t=this.dirty||e.node()!==this.d3el.node();this.d3el=e,this.readyToRender&&(t&&(this.updateContainerCharacteristics(e),this.setup(e),this.dirty=!1),clearTimeout(this.drawTimeout),this.drawTimeout=setTimeout(()=>{this.drawTimeout=null,this.draw(e)},this.debounceWait))}updateContainerCharacteristics(e){null!==e&&(this.bounds=e.node().getBoundingClientRect(),this.emSize=parseFloat(e.style("font-size")),this.scrollBarSize=this.computeScrollBarSize(e))}computeScrollBarSize(e){var t=document.createElement("div");t.style.visibility="hidden",t.style.width="100px",t.style.msOverflowStyle="scrollbar",e.node().appendChild(t);var s=t.offsetWidth;t.style.overflow="scroll";var i=document.createElement("div");i.style.width="100%",t.appendChild(i);var r=i.offsetWidth;return t.parentNode.removeChild(t),s-r}},Object.defineProperty(e,"__esModule",{value:!0})});
